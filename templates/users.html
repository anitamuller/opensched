{%- extends 'index.html' -%}
{%- block head -%}
{%- include 'head.html' -%}
{%- block additional_css -%}
<link href="{{ url_for('static', filename='css/metisMenu.min.css') }}" rel="stylesheet" media="screen">
<link href="{{ url_for('static', filename='css/sb-admin-2.css') }}" rel="stylesheet" media="screen">
<link href="{{ url_for('static', filename='font-awesome-4.1.0/css/font-awesome.min.css') }}" rel="stylesheet"
      media="screen">
{%- endblock -%}
{%- endblock -%}
{%- block body -%}
<div id="wrapper">
    {%- include 'side_nav.html' -%}
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                {%- if users -%}
                <div class="page-header">
                    <h1>Users</h1>
                </div>

                <div class="content">
                    {%- with messages = get_flashed_messages(with_categories=True) -%}
                    {%- if messages -%}
                    {%- for category, message in messages -%}
                    <div class="response">
                        <span class="message {{ category }}">{%- if category == 'success' -%}âœ”{%- endif -%}&nbsp;{{ message }}</span>
                    </div>
                    {%- endfor -%}
                    {%- endif -%}
                    {%- endwith -%}
                    <div class="table-actions">
                        <a href="{{ url_for('add_user') }}" class="btn btn-primary"><i class="fa fa-plus"></i> Add User</a>
                    </div>
                    <table style="margin-bottom: 0px; align: center; width: 60%;">
                        {%- for user in users -%}
                        <tr>
                            <td>
                                <img src="{{ user['gravatar_url'] }}" class="img-circle">
                            </td>
                            {%- if user['name'] -%}
                            <td><strong>{{ user['name'] }}</strong></td>
                            {%- else -%}
                            <td>{{ user['_id'] }}</td>
                            {%- endif -%}
                            <td><a title="Email" href="{{ url_for('edit_user', id=user['_id']) }}" data-target="_blank">{{ user['_id'] }}</a></td>
                            {%- if session.user.role == 'Admin' -%}
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-primary btn-sm dropdown-toggle"
                                            data-toggle="dropdown">
                                        <i class="fa fa-gear"></i> <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        {%- if user['active'] == '1' -%}
                                            <li><a title="Edit user" href="{{ url_for('edit_user', id=user['_id']) }}">Edit user</a></li>
                                        {%- else -%}
                                            <li><a title="Edit user" href="{{ url_for('edit_inactive_user', id=user['_id']) }}">Edit user</a></li>
                                        {%- endif -%}
                                        {%- if user['id'] != session['user']['email'] and user.role != 'Admin' -%}
                                        <li><a title="Delete user" href="{{ url_for('delete_user', id=user['_id']) }}">Delete user</a></li>
                                        {%- endif -%}
                                    </ul>
                                </div>
                            </td>
                            {%- endif -%}
                        </tr>
                        {%- endfor -%}
                    </table>
                </div>
                {%- endif -%}
            </div>
        </div>
    </div>
</div>
{%- endblock -%}
{%- block scripts -%}
<script src="{{ url_for('static', filename='js/jquery-2.1.1.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
<!-- Metis Menu Plugin JavaScript -->
<script src="{{ url_for('static', filename='js/metisMenu.min.js') }}"></script>
<!-- Custom Theme JavaScript -->
<script src="{{ url_for('static', filename='js/sb-admin-2.js') }}"></script>
{%- endblock -%}